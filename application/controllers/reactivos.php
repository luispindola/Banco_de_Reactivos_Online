<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Reactivos  extends CI_Controller {    public function index()    {        if ($this->session->userdata('nombre_usuario'))        {            //Si existe variable de session de nombre de usuario                                    $this->load->model('Reactivos_model');            $reactivos = $this->Reactivos_model->cargar_reactivos('asignatura');            $datos_vista = array(            'algun_error'=>  '',            'reactivos'  =>  $reactivos            );            //Cargar la variable que se pasará a la vista            $this->load->view('v_reactivos',$datos_vista);            //Llama vista        }        else        {            header('Location: /');        }    }    public function agregar_dTE($id_asignatura = null, $ciclo = null)    {        if ($this->session->userdata('nombre_usuario'))        {            //Si existe variable de session de nombre de usuario            if ((isset($id_asignatura) == false) && (isset($ciclo) == false))            {//Mostrar tabla de esp                //echo("sin argumentos");                $this->load->model('Reactivos_model');                $tablas_esp = $this->Reactivos_model->cargar_tabla_esp('asignatura');                $datos_vista = array(                'algun_error'=>  '',                'tablas_esp'  =>  $tablas_esp                );                //Cargar la variable que se pasará a la vista                $this->load->view('v_reactivos_agregar_te',$datos_vista);                //Llama vista            }            else            {                //echo("Agregar a BD de Reactivos: id_asignatura: ".$id_asignatura. " ciclo:".$ciclo);                $this->load->model('Reactivos_model');                //Primero checar que no exista asignatura-cciclo en reactivos:                if ($this->Reactivos_model->existe($id_asignatura,$ciclo))                {                    $error = '<div class="grid_16">';                    $error = $error. '<p class="error">Ya se encuentra cargada la Tabla de Especificaciones seleccionada</p>';                    $error = $error. '</div>';                    $tablas_esp = $this->Reactivos_model->cargar_tabla_esp('asignatura');                    $datos_vista = array(                    'algun_error'=>   $error,                    'tablas_esp'  =>  $tablas_esp                    );                    //Cargar la variable que se pasará a la vista                    $this->load->view('v_reactivos_agregar_te',$datos_vista);                    //Llama vista                }                  else                 {                    //Cargar datos de tablas de especificaciones en bd de reactivos:                    $this->Reactivos_model->cargar_en_bd_reactivos($id_asignatura,$ciclo);                    header('Location: /index.php/reactivos');                }            }        }        else        {            header('Location: /');        }    }    public function editar_reactivos($id_asignatura = null, $ciclo = null)    {        if ($this->session->userdata('nombre_usuario'))        {            $ciclo = str_replace('%20',' ',$ciclo);//Quitar caracteres de url            $this->load->model('Catalogos_model');            $this->load->model('Reactivos_model');            $asignatura = $this->Catalogos_model->dame_asignatura($id_asignatura);            $reactivos = $this->Reactivos_model->cargar_lista_reactivos($id_asignatura,$ciclo);            $datos_vista = array(            'algun_error'=>  '',            'asignatura' =>  $asignatura,            'ciclo'      =>  $ciclo,                'reactivos'  =>  $reactivos            );            //Cargar la variable que se pasará a la vista            $this->load->view('v_reactivos_editar_reactivos',$datos_vista);            //Llama vista        }        else        {            header('Location: /');        }    }    public function editar_reactivo($id_reactivos)    {        if ($this->session->userdata('nombre_usuario'))        {            if (isset($_POST['guardar']))            {//Rutina para guardar reg                $guardar = array(                    'reactivo'     =>    $_POST['reactivo'],                    'opcion_a'     =>    $_POST['opcion_a'],                    'opcion_b'     =>    $_POST['opcion_b'],                    'opcion_c'     =>    $_POST['opcion_c'],                    'opcion_d'     =>    $_POST['opcion_d'],                    'opcion_correcta'=>  $_POST['opcion_correcta'],                                        'mlog'         =>    $_POST['mlog'],                    'a_revision'   =>    $_POST['a_revision'],                    'f_editor'     => date("Y-m-d H:i:s"),                    'id_usuario_editor' => $this->session->userdata('id_usuarios')                );                $this->load->model('Reactivos_model');                $this->Reactivos_model->guardar_reactivo($id_reactivos,$guardar);                header('Location: /index.php/reactivos/editar_reactivo/'.$id_reactivos);            }            else            {                $this->load->model('Reactivos_model');                $this->load->model('Catalogos_model');                $row = $this->Reactivos_model->cargar_reactivo($id_reactivos);                $select_Opcion_Correcta = '<select name = "opcion_correcta" id="opcion_correcta">';                if ($row['opcion_correcta'] == "A")                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option selected="selected" value="A">A</option>';}                else                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option value="A">A</option>';}                if ($row['opcion_correcta'] == "B")                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option selected="selected" value="B">B</option>';}                else                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option value="B">B</option>';}                if ($row['opcion_correcta'] == "C")                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option selected="selected" value="C">C</option>';}                else                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option value="C">C</option>';}                if ($row['opcion_correcta'] == "D")                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option selected="selected" value="D">D</option>';}                else                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option value="D">D</option>';}                If (($row['opcion_correcta'] <> "A") &&                      ($row['opcion_correcta'] <> "B") &&                      ($row['opcion_correcta'] <> "C") &&                      ($row['opcion_correcta'] <> "D"))                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option selected="selected" value=" "> </option>';}                else                {$select_Opcion_Correcta = $select_Opcion_Correcta.'<option value=" "> </option>';}                $select_Opcion_Correcta = $select_Opcion_Correcta.'</select>';                $select_Enviar_Revision = '<select name = "a_revision" id="a_revision">';                if ($row['a_revision'] == "Si")                {$select_Enviar_Revision = $select_Enviar_Revision.'<option selected="selected" value="Si">Si</option>';}                else                {$select_Enviar_Revision = $select_Enviar_Revision.'<option value="Si">Si</option>';}                if ($row['a_revision'] == "No")                {$select_Enviar_Revision = $select_Enviar_Revision.'<option selected="selected" value="No">No</option>';}                else                {$select_Enviar_Revision = $select_Enviar_Revision.'<option value="No">No</option>';}                if (($row['a_revision'] <> "Si") &&                    ($row['a_revision'] <> "No"))                {$select_Enviar_Revision = $select_Enviar_Revision.'<option selected="selected" value=" "> </option>';}                else                {$select_Enviar_Revision = $select_Enviar_Revision.'<option value=" "> </option>';}                $select_Enviar_Revision = $select_Enviar_Revision.'</select>';                $datos_vista = array(                'algun_error'  =>  '',                'id_reactivos' =>  $row['id_reactivos'],                'asignatura'   =>  $this->Catalogos_model->dame_asignatura($row['id_asignatura']),                'id_asignatura'=>  $row['id_asignatura'],                'ciclo'        =>  $row['ciclo'],                 'parcial'      =>  $row['parcial'],                    'bloque'       =>  $row['bloque'],                 'secuencia'    =>  $row['secuencia'],                 'apr_indi_obj' =>  $row['apr_indi_obj'],                 'saberes'      =>  $row['saberes'],                 'dificultad'   =>  $row['dificultad'],                'reactivo'     =>  str_replace('999y999','\\',$row['reactivo']),                'opcion_a'     =>  str_replace('999y999','\\',$row['opcion_a']),                'opcion_b'     =>  str_replace('999y999','\\',$row['opcion_b']),                'opcion_c'     =>  str_replace('999y999','\\',$row['opcion_c']),                'opcion_d'     =>  str_replace('999y999','\\',$row['opcion_d']),                'select_Opcion_Correcta' => $select_Opcion_Correcta,                                    'mlog'         =>  $row['mlog'],                    'select_Enviar_Revision' => $select_Enviar_Revision                   );                //Cargar la variable que se pasará a la vista                $this->load->view('v_reactivos_editar_reactivo',$datos_vista);                //Llama vista            }        }        else        {            header('Location: /');        }    }}?>